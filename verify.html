<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Verify email — ProfitPilot</title>
  <meta name="robots" content="noindex,nofollow">
  <link rel="icon" href="https://ukwebtools.com/favicon.svg" type="image/svg+xml">

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --bg:#0b0f14; --card:#111826; --card2:#0e1521;
      --txt:#eaf0ff; --muted:#9aa7bd; --line:rgba(255,255,255,.10);
      --accent:#5eead4; --accent2:#60a5fa;
      --good:#34d399; --warn:#fbbf24; --bad:#fb7185;
      --shadow:0 18px 46px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(900px 520px at 20% 0%, rgba(94,234,212,.12), transparent 55%),
        radial-gradient(900px 520px at 80% 0%, rgba(96,165,250,.10), transparent 55%),
        linear-gradient(180deg, #090c11, var(--bg));
      color:var(--txt);
    }
    .wrap{max-width:520px;margin:40px auto 70px;padding:0 14px}
    .card{
      background:linear-gradient(180deg,rgba(94,234,212,.10),transparent 60%),var(--card);
      border:1px solid var(--line);border-radius:18px;padding:20px;box-shadow:var(--shadow);
    }
    h1{margin:0;font-size:20px;letter-spacing:-.02em}
    .lead{margin-top:8px;color:rgba(234,240,255,.75);line-height:1.6;font-size:13px}
    .msg{
      margin-top:12px;font-size:12.5px;line-height:1.55;color:rgba(234,240,255,.78);
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.08);
      border-radius:14px;padding:10px 12px;white-space:pre-wrap;
    }
    .msg.ok{border-color:rgba(52,211,153,.22);background:rgba(52,211,153,.06)}
    .msg.bad{border-color:rgba(251,113,133,.22);background:rgba(251,113,133,.06)}
    .msg.warn{border-color:rgba(251,191,36,.20);background:rgba(251,191,36,.06)}
    input{
      width:100%;padding:12px;border-radius:14px;border:1px solid var(--line);
      background:var(--card2);color:var(--txt);outline:none;margin-top:10px;
    }
    .btn{
      width:100%;margin-top:14px;padding:12px;border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.03);color:var(--txt);
      cursor:pointer;font-weight:1000;
    }
    .btn.primary{
      border:none;color:#0b1220;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      box-shadow:0 14px 28px rgba(96,165,250,.16);
    }
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Verify your email</h1>
      <div class="lead">
        We sent you a verification link. Open it, then come back and log in.
        (Check Spam/Promotions too.)
      </div>

      <input id="email" type="email" placeholder="your email (for resend)" autocomplete="email">
      <button class="btn" id="resend" type="button">Resend verification email</button>

      <button class="btn primary" id="goLogin" type="button">Go to login</button>

      <div class="msg" id="msg">—</div>

      <div class="lead" style="margin-top:12px">
        If you keep getting nothing, your Supabase Auth URLs likely aren’t set correctly.
      </div>
    </div>
  </div>

  <script>
    const SUPABASE_URL = "https://xsigsftvfknefpdfsyae.supabase.co";
    const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhzaWdzZnR2ZmtuZWZwZGZzeWFlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAyNzY4NjksImV4cCI6MjA4NTg1Mjg2OX0.Jkkh9Jd46saYBVipN8bxbWhjmhG6mgaFgtTpirKUAWg";

    const msg = document.getElementById("msg");
    function setMsg(t,k=""){ msg.textContent=t; msg.className="msg"+(k?" "+k:""); }

    if (!window.supabase || !window.supabase.createClient){
      setMsg("Supabase library failed to load. Check your internet/CDN.", "bad");
      throw new Error("Supabase not loaded");
    }

    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON, {
      auth: {
        persistSession:true,
        autoRefreshToken:true,
        detectSessionInUrl:true,
        flowType:"pkce",
        storageKey:"profitpilot_auth"
      }
    });

    function redirectToLoginUrl(){
      return new URL("login.html", location.origin).toString();
    }

    const emailEl = document.getElementById("email");
    emailEl.value = localStorage.getItem("pp_pending_email") || "";

    document.getElementById("goLogin").addEventListener("click", ()=> location.href="login.html");

    document.getElementById("resend").addEventListener("click", async ()=>{
      const email = (emailEl.value || "").trim();
      if (!email){ setMsg("Enter your email first.", "bad"); return; }

      setMsg("Resending…");
      try{
        const { error } = await supabaseClient.auth.resend({
          type: "signup",
          email,
          options: { emailRedirectTo: redirectToLoginUrl() }
        });
        if (error) throw error;
        setMsg("Sent. Check your inbox (and Spam/Promotions).", "ok");
      } catch (e){
        setMsg("Resend failed.\n\nRaw: " + (e?.message || e), "bad");
      }
    });

    setMsg(
      "Redirect URL used:\n" + redirectToLoginUrl() +
      "\n\nIf Supabase rejects it, add it in Supabase → Auth → URL Configuration.",
      "warn"
    );
  </script>
</body>
</html>
